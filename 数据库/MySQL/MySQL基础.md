# 一、数据库概述与MySQL安装

## 1、数据库概述

### Ⅰ 为什么要使用数据库

- **持久化(persistence)**：把数据保存到可掉电式存储设备中以供之后使用。大多数情况下，特别是企业级应用，**数据持久化意味着将内存中的数据保存到硬盘上加以”固化”**，而持久化的实现过程大多通过各种关系数据库来完成。
- **持久化的主要作用是**将内存中的数据存储在关系型数据库中，当然也可以存储在磁盘文件、XML数据文件中。

### Ⅱ **数据库与数据库管理系统**

1. **数据库相关概念**

   | **DB**：数据库（Database）                                   |
   | ------------------------------------------------------------ |
   | 即存储数据的“仓库”，其本质是一个文件系统。它保存了一系列有组织的数据。 |
   | **DBMS**：数据库管理系统（Database Management System）       |
   | 是一种操纵和管理数据库的大型软件，用于建立、使用和维护数据库，对数据库进行统一管理和控制。用户通过数据库管理系统访问数据库中表内的数据。 |
   | **SQL：结构化查询语言（Structured Query Language）**         |
   | 专门用来与数据库通信的语言。                                 |

2. **数据库与数据库管理系统的关系**

   - 数据库管理系统(DBMS)可以管理多个数据库，一般开发人员会针对每一个应用创建一个数据库。为保存应用中实体的数据，一般会在数据库创建多个表，以保存程序中实体用户的数据。
   
   - 数据库管理系统、数据库和表的关系如图所示：
   
     ![image-20220211155258862](https://cdn.jsdelivr.net/gh/mrsenmu/JavaLearningNotes/images/202202161657350.png)
   
   - **常见的数据库管理系统排名(DBMS)**
   
     - 目前互联网上常见的数据库管理软件有Oracle、MySQL、MS SQL Server、DB2、PostgreSQL、Access、 Sybase、Informix这几种。
     - 以下是2021年**DB-Engines Ranking** 对各数据库受欢迎程度进行调查后的统计结果：（查看数据库最新排名: **https://db-engines.com/en/ranking**）。
     
   - **常见数据库介绍**
     
     - **Oracle**：第一个商用的 RDBMS（关系型数据库管理系统）。
     - **SQL Server**：QL Server 是微软开发的大型商业数据库，诞生于 1989 年。C#、.net等语言常使用。
     - **DB2**：IBM公司的数据库产品,收费的。常应用在银行系统中。
     - **PostgreSQL**：稳定性极强，最符合SQL标准，开放源码，具备商业级DBMS质量。PG对数据量大的文本以及SQL处理较快。
     - **SyBase**：已经淡出历史舞台。提供了一个非常专业数据建模的工具PowerDesigner。
     - **SQLite**：嵌入式的小型数据库，应用在手机端。 零配置，SQlite3不用安装，不用配置，不用启动，关闭或者配置数据库实例。当系统崩溃后不用做任何恢复操作，再下次使用数据库的时候自动恢复。
     - **informix**：IBM公司出品，取自Information 和Unix的结合，它是第一个被移植到Linux上的商业数据库产品。仅运行于unix/linux平台，命令行操作。 性能较高，支持集群，适应于安全性要求极高的系统，尤其是银行，证券系统的应用。
   
3. **MySQL介绍**

   1. **概述**
      - MySQL是一个开放源代码的关系型数据库管理系统由瑞典MySQL AB（创始人Michael Widenius）公司1995年开发，迅速成为开源数据库的 No.1。
      - MySQL6.x 版本之后分为社区版和商业版。
      - MySQL是一种关联数据库管理系统，将数据保存在不同的表中，而不是将所有数据放在一个大仓库内，这样就增加了速度并提高了灵活性。
      - MySQL是可以定制的，采用了GPL（GNU General Public License)协议，你可以修改源码来开发自己的MySQL系统。
      - MySQL支持大型数据库，支持5000万条记录的数据仓库，32位系统表文件最大可支持4GB，64位系统支持最大的表文件为8TB。
      - MySQL可以允许运行于多个系统上，并且支持多种语言。这些编程语言包括C、C++、Python、Java、Perl、PHP和Ruby等。
   
   2. 为什么如此多的厂商要选用MySQL的原因：
      -  开放源代码，使用成本低。
      - 性能卓越，服务稳定。
      - 软件体积小，使用简单，并且易于维护。
      -  历史悠久，社区用户非常活跃，遇到问题可以寻求帮助。
      -  许多互联网公司在用，经过了时间的验证。
   
   3. Oracle vs MySQL
      - Oracle 更适合大型跨国企业的使用，因为他们对费用不敏感，但是对性能要求以及安全性有更高的要求。
      - MySQL 由于其**体积小、速度快、总体拥有成本低，可处理上千万条记录的大型数据库，尤其是开放源码这一特点，使得很多互联网公司、中小型网站选择了MySQL作为网站数据库**（Facebook，Twitter，YouTube，阿里巴巴/蚂蚁金服，去哪儿，美团外卖，腾讯）。
   
4.  **RDBMS 与 非RDBMS**

   从排名中我们能看出来，**关系型数据库**绝对是 DBMS 的主流，其中使用最多的 DBMS 分别是 Oracle、MySQL 和 SQL Server。这些都是关系型数据库（RDBMS）。

   **关系型数据库(RDBMS)**
   
   1.  **实质**
      - 关系型数据库模型是把复杂的数据结构归结为简单的二元关系（即二维表格形式）
      - 关系型数据库以**行(row)**和**列(column)**的形式存储数据，这一系列的行和列被称为**表(table)**，一组表组成了一个**库(database)**。
      - 表与表之间的数据记录有关系(relationship)。现实世界中的各种实体以及实体之间的各种联系均用**关系模型**。
      - SQL就是关系型数据库的查询语言。
   2. **优势**
      - **复杂查询** 可以用SQL语句方便的在一个表以及多个表之间做非常复杂的数据查询。
      - **事务支持** 使得对于安全性能很高的数据访问要求得以实现。
   
   **非关系型数据库(非RDBMS)**
   
   1. **介绍**：
   
      **非关系型数据库**可看成传统关系型数据库的功能阉割版本，基于键值对存储数据，不需要经过SQL层的解析，**性能非常高**。同时，通过减少不常用的功能，进一步提高性能。相比于 SQL，NoSQL 泛指非关系型数据库，包括了榜单上的键值型数据库、文档型数据库、搜索引擎和列存储等，除此以外还包括图形数据库。
   
   2. **有哪些**：
   
      （1）**键值型数据库**：键值型数据库通过 Key-Value 键值的方式来存储数据，其中 Key 和 Value 可以是简单的对象，也可以是复杂的对象。Key 作为唯一的标识符，**优点**是**查找速度快**，在这方面明显优于关系型数据库，**缺点**是**无法**像关系型数据库一样使用**条件过滤**（比如 WHERE），如果你不知道去哪里找数据，就要遍历所有的键，这就会消耗大量的计算。键值型数据库典型的使用场景是作为内存缓存。**Redis**是最流行的键值型数据库。
   
      （2）**文档型数据库**：此类数据库可存放并获取文档，可以是XML、JSON等格式。在数据库中文档作为处理信息的基本单位，一个文档就相当于一条记录。文档数据库所存放的文档，就相当于键值数据库所存放的“值”。**MongoDB** 是最流行的文档型数据库。
   
      （3）**搜索引擎数据库**：虽然关系型数据库采用了索引提升检索效率，但是针对全文索引效率却较低。搜索引擎数据库是应用在搜索引擎领域的数据存储形式，由于搜索引擎会爬取大量的数据，并以特定的格式进行存储，这样在检索的时候才能保证性能最优。核心原理是**“倒排索引”**。典型产品：Solr、**Elasticsearch**、Splunk 等。
   
      （4）**列式数据库**：是相对于行式存储的数据库，Oracle、MySQL、SQL Server 等数据库都是采用的行式存储（Row-based），而列式数据库是**将数据按照列存储到数据库中**，这样做的**好处是可以大量降低系统的I/O，适合于分布式文件系统**，不足在于功能相对有限。典型产品：HBase等。
   
      （5）**图形数据库**：利用了**图这种数据结构存储了实体（对象）之间的关系**。图形数据库最典型的例子就是社交网络中人与人的关系，数据模型主要是以节点和边（关系）来实现，特点在于能高效地解决复杂的关系问题。
      图形数据库顾名思义，就是一种存储图形关系的数据库。它利用了图这种数据结构存储了实体（对象）之间的关系。关系型数据用于存储明确关系的数据，但对于复杂关系的数据存储却有些力不从心。如社交网络中人物之间的关系，如果用关系型数据库则非常复杂，用图形数据库将非常简单。典型产品：Neo4J、InfoGrid等。
   
   3. **NoSQL的演变**
   
      NoSQL 对 SQL 做出了很好的补充，比如**实际开发中，有很多业务需求，其实并不需要完整的关系型数据库功能**，非关系型数据库的功能就足够使用了。这种情况下，使用**性能更高、成本更低**的非关系型数据库当然是更明智的选择。比如：**日志收集、排行榜、定时器**等。
   
5.  **关系型数据库设计规则**

   - **表、记录、字段**

      - E-R（entity-relationship，实体-联系)模型中有三个主要概念是：**实体集、属性、联系集**。

      - 一个实体集（class）对应于数据库中的一个表（table），一个实体（instance）则对应于数据库表中的一行（row），也称为一条记录（record）。一个属性（attribute）对应于数据库表中的一列（column），也称为一个字段（field）。

      - ```
         ORM思想（Object Relational Mapping）体现：
         数据库中的一个表 <---> 面向对象语言中的一个类
         表中一行 <---> 类中的一个对象（或实体）
         表中一列 <---> 类中的一个字段、属性(field)
        ```

   - **表的关联关系**

      表与表之间的数据记录有关系(relationship)。现实世界中的各种实体以及实体之间的各种联系均用**关系模型**来表示。**四种：一对一关联、一对多关联、多对多关联、自我引用。**

      1. **一对一关联（one-to-one）**
         - 在实际的开发中应用不多，因为一对一可以创建成一张表。
         - 如用户信息表可拆分成用户基本信息表和用户详情表。
         - 原则：主表的主键和从表的外键（唯一），形成主外键关系，外键唯一。
      2.  **一对多关系（one-to-many）**
         - 如商品分类表和商品信息表。一个分类对应多个商品。
         - 原则：在从表(多方)创建一个字段，字段作为外键指向主表(一方)的主键。
      3. **多对多（many-to-many）**
         - 要表示多对多关系，必须**创建第三个表**，该表通常称为**联接表**，它将多对多关系划分为两个一对多关系。**将这两个表的主键都插入到第三个表中**。
         - 如：学生-课程、商品-订单、用户-角色等关系。
      4. **自我引用(Self reference)**
         - 如分类表中有id（主键）、parent_id(父级分类id)。

## 2、MySQL环境搭建（Windows环境）

详情可参考 [MySQL安装与卸载教程（Windows）](https://gitee.com/mrsenmu/JavaLearningNotes/blob/main/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/MySQL%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA(Windows).md)

# 二、SQL与SELECT的使用

## 1、SQL概述

### Ⅰ 背景

- 1974 年，IBM 研究员发布了一篇揭开数据库技术的论文《SEQUEL：一门结构化的英语查询语言》，直到今天这门结构化的查询语言并没有太大的变化。
- SQL（Structured Query Language，结构化查询语言）是使用关系模型的数据库应用语言。与数据直 接打交道 ，由 IBM 上世纪70年代开发出来。后由美国国家标准局（ANSI）开始着手制定SQL标准，先后有 SQL-86 ， SQL-89 ， SQL-92 ， SQL-99 等标准。**SQL92 和 SQL99，它们分别代表了 92 年和 99 年颁布的 SQL 标准，我们今天使用的 SQL 语言依然遵循这些标准。**
- 不同的数据库生产厂商都支持SQL语句，但都有特有内容。相当于，SQL规范（普通话），MySQL特有（方言）。

### Ⅱ SQL分类（三大类）

1. **DDL（Data Definition Languages 数据定义语言）**：这些语句定义了不同的数据库、表、视图、索引等数据库对象，还可以用来创建（CREATE）、删除（DROP）、修改（ALTER）数据库和数据表的结构。
2. **DML（Data Manipulation Language 数据操作语言）**：用于添加（INSERT）、删除（DELETE）、更新（UPDATE）和查询（SELECT）数据库记录，并检查数据完整性。其中，**SELECT是SQL语言的基础，最为重要**。
3. **DCL（Data Control Language 数据控制语言）**：用于定义数据库、表、字段、用户的访问权限和安全级别。主要的语句关键字包括 **GRANT 、 REVOKE 、 COMMIT 、 ROLLBACK 、 SAVEPOINT** 等。
4. 注意：因为查询语句使用的非常的频繁，所以很多人把查询语句单拎出来一类：**DQL（数据查询语言）**。还有单独将 COMMIT 、 ROLLBACK 取出来称为**TCL （Transaction Control Language，事务控制语言）**。

## 2、SQL语言的规则与规范

### Ⅰ 基本规则

- SQL 可以写在一行或者多行。为了提高可读性，各子句分行写，必要时使用缩进。每条命令以 ; 或 \g 或 \G 结束。
- 关键字不能被缩写也不能分行。
- 关于标点符号：
  - 必须保证所有的()、单引号、双引号是成对结束的。
  - 必须使用英文状态下的半角输入方式。
  - 字符串型和日期时间类型的数据可以使用单引号 ' ' 表示。
  - 列的别名，尽量使用双引号 " " ，而且不建议省略as。

### Ⅱ SQL大小写规范

- MySQL 在 **Windows** 环境下是大小写**不敏感**的。
- MySQL 在 **Linux** 环境下是大小写**敏感**的。
- **推荐采用统一的书写规范：**
  - **数据库名、表名、表别名、字段名、字段**别名等都**小写**。
  - **SQL 关键字、函数名、绑定变量**等都**大写**。

### Ⅲ 注释

```sql
单行注释：#注释文字(MySQL特有的方式)
单行注释：-- 注释文字(--后面必须包含一个空格。)
多行注释：/* 注释文字 */
```

### Ⅳ 命名规则

- 数据库、表名不得超过30个字符，变量名限制为29个。
- 必须只能包含 A–Z, a–z, 0–9, _共63个字符。
- 数据库名、表名、字段名等对象名中间不要包含空格。
- 同一个MySQL软件中，数据库不能同名；同一个库中，表不能重名；同一个表中，字段不能重名。
- 必须保证你的字段没有和保留字、数据库系统或常用方法冲突。如果坚持使用，请在SQL语句中使用着重号 `` (英文输入法，通常为左上角1号键左边)引起来。
- 保持字段名和类型的一致性，在命名字段并为其指定数据类型的时候一定要保证一致性。假如数据类型在一个表里是整数，那在另一个表里可就别变成字符型了。

### Ⅴ 数据导入指令

在命令行客户端登录mysql，使用source指令导入

```mysql
#导入
mysql> source d:\mysqldb.sq;
#查看表结构指令desc
mysql> desc table_name;
```

## 3、基本的SELECT语句

### Ⅰ SELECT

```mysql
SELECT 1; #没有任何子句
SELECT column_name1, column_name2,... FROM table_name #指定表、字段查询
SELECT * FROM table_name #查询指定表所有字段
```

注意：在生产环境下，不推荐直接使用 SELECT * 进行查询。是获取不需要的列数据通常会**降低查询和所使用的应用程序的效率**。通配符的优势是，当不知道所需要的列的名称时，可以通过它获取它们。

### Ⅱ 列的别名（AS 关键字）

- 重命名一个列，便于计算，紧跟列名，**在列名和别名之间加入关键字AS。可省略关键字AS**。
- **别名可使用双引号**，以便在别名中包含空格或特殊的字符并区分大小写。

```mysql
SELECT last_name AS name, commission_pct comm FROM employees;
SELECT last_name "Name", salary*12 "Annual Salary" FROM employees;
```

### Ⅲ 去重复行(关键字DISTINCT)

默认情况下，查询会返回全部行，包括重复行。

```mysql
#在SELECT语句中使用关键字DISTINCT去除重复行
SELECT name FROM students
```

注意：DISTINCT 需要放到所有列名的前面，否则报错；DISTINCT 其实是对后面所有**列名的组合**进行去重。这意味着组合中所有字段值都相同才算一条重复的数据而被去重。

### Ⅳ 空值参与运算

所有运算符或列值遇到null值，运算的结果都为null。

### Ⅴ 着重号

我们需要保证表中的字段、表名等没有和保留字、数据库系统或常用方法冲突。如果真的相同，请在SQL语句中使用一对``（着重号）引起来。

```mysql
mysql> SELECT * FROM ORDER; #报错
mysql> SELECT * FROM `ORDER`; #正常运行
```

### Ⅵ 查询常数

SELECT 查询还可以对常数进行查询。就是在 SELECT 查询结果中增加一列固定的常数列。这列的取值是我们指定的，而不是从数据表中动态取出的。

如下查询学生表时，增加一个常数字段class，值固定为1班。

```mysql
SELECT '1班' AS class, name FORM students
```

### Ⅶ 查询条件语句（WHERE）

```mysql
#语法 WHERE子句紧随 FROM子句
SELECT 字段1, 字段2,...
FROM 表名
WHERE 布尔表达式1 [AND[OR]] 布尔表达式2
```

## 4、运算符

### Ⅰ 算术运算符

算术运算符主要用于数学运算，其可以连接运算符前后的两个数值或表达式，对数值或表达式进行 加（+）、减（-）、乘（*）、除（/）和取模（%）运算。

| 运算符 | 作用         | 示例                          |
| ------ | ------------ | ----------------------------- |
| +      | 加法         | SELECT A+B                    |
| -      | 减法         | 计算两个值或表达式的差        |
| *      | 乘法         | SELECT A*B                    |
| /或DIV | 除法         | SELECT A/ B 或 SELECT A DIV B |
| %或MOD | 求模（取余） | SELECT A%B                    |

**注意**：

- **加减法**：整数与浮点数操作结果为浮点数；在MySQL中**+只表示数值相加**。如果遇到非数值类型，先尝试转成数值，如果转失败，就按0计算。（补充：MySQL中字符串拼接要使用字符串函数CONCAT()实现）。
- **乘除法**：整数乘、除以浮点数结果为浮点数；**一个数除以整数后，不管是否能除尽，结果都为一个浮点数**(保留小数点后4位)；MySQL中，一个数除以0为NULL。 

### Ⅱ 比较运算符

比较运算符用来对表达式左边的操作数和右边的操作数进行比较，比较的结果为**真则返回1**，比较的结果为**假则返回0**，其他情况则返回NULL。

比较运算符经常被用来作为SELECT查询语句的条件来使用（**WHERE关键字后面**），返回符合条件的结果记录。

| 运算符 | 作用     |
| ------ | -------- |
| =      | 等于     |
| <=>    | 安全等于 |
| <>(!=) | 不等于   |
| <      | 小于     |
| <=     | 小于等于 |
| >      | 大于     |
| >=     | 大于等于 |

注意：

- 比较字符串时MySQL比较的是每个字符串中字符的**ANSI编码**是否相等。
- 如果等号两边的值一个是整数，另一个是字符串，则MySQL会将字符串转化为数字进行比较。
- **如果等号（=）和不等号（<>和!=）两边的值、字符串或表达式中有一个为NULL，则比较结果为NULL**。
- **安全等于运算符** 安全等于运算符（<=>）与等于运算符（=）的作用是相似的， **唯一的区别 是‘<=>’可以用来对NULL进行判断**。在两个操作数均为NULL时，其返回值为1，而不为NULL；当一个操作数为NULL时，其返回值为0，而不为NULL。

### Ⅲ 逻辑运算符

逻辑运算符主要用来判断表达式的真假，在MySQL中，逻辑运算符的返回结果为1、0或者NULL（**表达式中存在NULL时结果都为NULL**）。 

MySQL中支持4种逻辑运算符如下：

| 运算符号 | 作用     |
| :------- | :------- |
| NOT 或 ! | 逻辑非   |
| AND      | 逻辑与   |
| OR       | 逻辑或   |
| XOR      | 逻辑异或 |

### Ⅳ 位运算

位运算符是在二进制数上进行计算的运算符。位运算符会先将操作数变成二进制数，然后进行位运算，最后将计算结果从二进制变回十进制数。

MySQL支持的位运算符如下：

| 运算符号 | 作用              |
| :------- | :---------------- |
| &        | 按位与（位AND）   |
| \|       | 按位或（位OR）    |
| ^        | 按位异或（位XOR） |
| !        | 按位取反          |
| <<       | 左移              |
| >>       | 右移              |

### Ⅴ 非符号类型运算符

| 运算符        | 名称             | 作用                                     |
| ------------- | ---------------- | ---------------------------------------- |
| IS NULL       | 为空运算符       | 判断值、字符串或表达式是否为空           |
| IS NOT NULL   | 不为空运算符     | 判断值、字符串或表达式是否不为空         |
| LEAST         | 最小值运算符     | 在多个值中返回最小值                     |
| GREATEST      | 最大值运算符     | 在多个值中返回最大值                     |
| BETWEEN AND   | 两值之间的运算符 | 判断一个值是否在两个值之间               |
| IN            | 属于运算符       | 判断一个值是否为列表中的任意一个值       |
| NOT IN        | 不属于运算符     | 判断一个值是否不是一个列表中的任意一个值 |
| LIKE          | 模糊匹配运算符   | 判断一个值是否符合模糊匹配规则           |
| REGEXP和RLIKE | 正则表达式运算符 | 判断一个值是否符合正则表达式的规则       |

LIKE：常用通配符：% 、_ 、escape

```
% : 匹配0个或任意多个字符
_ : 匹配任意一个字符
escape ： 转义字符，可匹配%和_。如SELECT * FROM table_name WHERE column_name LIKE '/%/_%_' ESCAPE'/'
```

RLIKE和REGEXP :常用通配符：. 、* 、 [] 、 ^ 、 $ 、{n}

```
^ : 匹配开头，如'^s'匹配以s或者S开头的字符串。
$ : 匹配结尾，如's$'匹配以s结尾的字符串。
. : 匹配任意单个字符。
* : 匹配0个或多个前一个字符，如'a*'。
+ : 匹配1个或多个前一个字符。
[ ] : 匹配在方括号内的任何字符。例如，'[abc]'匹配'a'或'b'或'c'。为了命名字符的范围，使用一 个'-'。'[a-z]'匹配任何字母，而'[0-9]'匹配任何数字。
[^ ] : 匹配不在方括号内的任何字符。如'[^abc]'。匹配不是'a'或'b'或'c'的字符。
{n} : 匹配前一个字符反复n次。
{n,m} : 匹配前一个字符最少n次，最多m次。
```

注意：
1. 在MySQL中，like、rlike和regexp都不区分大小写，如果需要区分，可以在WHERE后添加关键字段binary。
2. like是完全匹配。rlike和regexp是不完全匹配，只要不同时匹配^和 $， 其他的包含即可。如 ^ba可以匹配baaa和baab，a也可以匹配baaa和baab，但是^bab$不能匹配baab。

## 5、排序与分页



## 6、多表查询



## 7、单行函数



## 8、聚合函数



## 9、子查询



# 三、SQL之DDL、DML、DCL的使用

## 1、创建和管理库



## 2、创建和管理表



## 3、数据处理之增删改查



## 4、MySQL数据类型



## 5、约束



# 四、其他数据库对象

## 1、视图



## 2、存储过程



## 3、变量、流程图与游标



## 4、触发器



# 五、MySQL8.0其他新特性

## 1、窗口函数



## 2、公用表表达式